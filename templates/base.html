{% load static %}
<!doctype html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Base Template</title>
    {% include 'base/css.html' %}
    {% block base_head %} {% endblock base_head %}
</head>
<body>
    {% include 'base/navbar.html' with nome_da_marca='Loja do Fábio' %}
    <div class="container">
        {% block content %} {% endblock %}
    </div>
    {% include 'base/js.html' %}

    <script>
        $(document).ready(function(){
            const productForm = $(".form-product-ajax")

            productForm.submit(function(event){
                event.preventDefault();
                console.log("O formulário não foi enviado!!!");

                //O this pega os dados reacionados a esse formulário
                const thisForm = $(this);
                const actionEndPoint = thisForm.attr("action");
                const httpMethod = thisForm.attr("method");
                const formData = thisForm.serialize();

                $.ajax({
                    url:actionEndPoint,
                    method:httpMethod,
                    data:formData,
                    success:function(data){
                        console.log("Sucesso!!!")
                        console.log(data)
                        console.log("Adicionado",data.added)
                        console.log("Removido",data.removed)

                        const submitSpan = thisForm.find(".submit-span")

                        if(data.added){
                            submitSpan.html("No carrinho <button type='submit' class='btn btn-link'>Excluir</button>")
                        }else{
                            submitSpan.html("<button type='submit' class='btn btn-success'>Adicionar</button>")
                        }
                    },
                    error:function(errorData){
                        console.log("Erro...")
                        console.log(errorData)
                    }
                })
            })
        })
    </script>
</body>
</html>